# 交易系统指令合集

## 一、基础命令（在讨论模式下输入）

| 命令 | 说明 | 示例 |
|------|------|------|
| 设置品种 [品种] | 设置交易品种 | 设置品种 XAUUSD |
| 设置手数 [手数] | 设置交易手数 | 设置手数 0.1 |
| 设置策略 [策略] | 设置交易策略 | 设置策略 MA金叉 |
| 设置间隔 [秒] | 设置监控间隔 | 设置间隔 1 |
| 查看配置 | 查看当前配置 | 查看配置 |
| 策略固定，开始盯盘 | 开始自动交易 | 策略固定，开始盯盘 |
| 自动配置 | AI自动分析配置 | 自动配置 |
| 退出 | 退出程序 | 退出 |

---

## 二、Rules 字段配置（Web界面设置）

在 Web 页面的 Rules 栏目中写入以下规则，系统会自动解析：

### 风险控制

```
最大回撤率: 5%        # 亏损达到5%时暂停交易，并一键平仓
每日最大亏损: 100     # 每日亏损达到100美元时暂停交易，并一键平仓
```

### 交易时段

```
交易时段: 09:00-17:00    # 只在此时段内交易
交易时段: 22:00-02:00    # 跨夜交易时段
```

### 点差过滤

```
点差限制: 30点    # 超过30点时不执行交易
```

### 移动止损

```
移动止损: 激活0.5%, 距离0.3%
# 盈利达到0.5%时激活移动止损，止损距离为0.3%
```

### 部分平仓

```
部分平仓: 0.3%, 50%
# 盈利达到0.3%时，平掉50%的仓位
```

### 更高时间周期确认

```
更高周期: 5分钟    # 使用5分钟周期确认趋势方向
更高周期: 15分钟   # 使用15分钟周期确认趋势方向
```

### 持仓限制

```
最大持仓: 5单    # 最多同时持有5个订单
```

### 一键平仓热键

```
平仓热键: ctrl+shift+c    # MT5一键平仓的热键
```

---

## 三、一键平仓功能

### 设置步骤

1. **在 MT5 中设置热键**：
   - 打开 MT5
   - `工具` → `选项` → `热键`
   - 找到 `全部平仓` 或 `Close All`
   - 设置热键，例如：`Ctrl+Shift+C`

2. **在 Rules 中配置热键**：
   ```
   平仓热键: ctrl+shift+c
   ```

### 触发逻辑

当触及每日底线（最大回撤率或每日最大亏损）时：
1. 系统自动发送"一键平仓"命令
2. Executor 接收命令后按下热键
3. MT5 执行全部平仓
4. 等待所有持仓平仓后保持暂停状态
5. 恢复交易：人工重启程序 或 第二天24:00

---

## 四、完整 Rules 配置示例

```
规则：
1. 所有技术指标包括k线都是1分钟级别
2. 持仓同时最多持有5单
3. 最大回撤率: 3%
4. 每日最大亏损: 50
5. 交易时段: 09:00-17:00
6. 点差限制: 30点
7. 移动止损: 激活0.5%, 距离0.3%
8. 部分平仓: 0.3%, 50%
9. 更高周期: 5分钟
10. 最大持仓: 5单
11. 平仓热键: ctrl+shift+c
```

---

## 五、做单条件配置（Web界面）

### 做多策略 (long_strategy)

```
1. 价格 > EMA9 > EMA21
2. 当前K线成交量 ≥ 前3根均量的150%
3. RSI 上穿 40
```

### 做空策略 (short_strategy)

```
1. 价格 < EMA9 < EMA21
2. 当前K线成交量 ≥ 前3根均量的150%
3. RSI 下穿 60
```

### 止损止盈设置

| 设置 | 说明 | 示例 |
|------|------|------|
| 做多止损比例 | 做多止损% | 0.3% |
| 做多止盈比例 | 做多止盈% | 0.6% |
| 做空止损比例 | 做空止损% | 0.3% |
| 做空止盈比例 | 做空止盈% | 0.6% |

---

## 六、技术指标说明

### EMA 指数移动平均线
- EMA9: 9周期指数移动平均
- EMA21: 21周期指数移动平均
- EMA12, EMA26: MACD组成部分

### RSI 相对强弱指标
- RSI < 30: 超卖区域，可能反转做多
- RSI > 70: 超买区域，可能反转做空
- RSI 上穿 40: 做多信号
- RSI 下穿 60: 做空信号

### 成交量分析
- 当前成交量 ≥ 150% × 3周期均量: 放量信号

### 蜡烛图形态
- 看涨吞没: 做多信号
- 看跌吞没: 做空信号
- 锤子线: 可能反转做多
- 上吊线: 可能反转做空
- 十字星: 观望

### 更高周期趋势
- 上涨趋势: EMA9 > EMA21 > EMA50
- 下跌趋势: EMA9 < EMA21 < EMA50
- 震荡: 均线交织

---

## 七、暂停与恢复逻辑

### 触发暂停条件
- 亏损达到最大回撤率
- 亏损达到每日最大亏损金额

### 暂停后的行为
1. 立即发送一键平仓命令
2. 等待现有持仓平仓（止盈或止损）
3. 保持暂停状态

### 恢复交易的方式
1. 人工重启程序（重新计算回撤）
2. 到了当地时间 24:00（第二天自动重置）

---

## 八、文件位置

| 文件 | 说明 |
|------|------|
| config.json | 配置文件 |
| commands.txt | 交易指令（程序写入） |
| market_cache.json | 行情缓存 |
| autogpt.log | 运行日志 |

---

更新时间: 2026-02-21